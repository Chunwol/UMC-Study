<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 API 테스트하기</title>
    <style>
        body { padding: 20px; font-family: sans-serif; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .result { margin-top: 20px; white-space: pre-wrap; background: #f4f4f4; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>회원가입 API 테스트</h1>
    <button id="signupButton">가입 요청 (성공)</button>
    <button id="signupButtonFail">가입 요청 (실패 - 이메일 중복)</button>

    <div id="resultArea" class="result">결과가 여기에 표시됩니다.</div>

    <script>
        // [중요] 서버 포트가 3000번이면 아래를 'http://localhost:3000'으로 변경하세요.
        const API_URL = 'http://localhost:80'; 

        // 1. 성공 테스트 
        document.getElementById('signupButton').onclick = async () => {
            // 매번 다른 이메일을 생성하여 중복 방지
            const uniqueEmail = `user_${Date.now()}@umc.com`;
            
            const userData = {
                email: uniqueEmail,
                password: "password1234",
                name: "천월",
                gender: "male",         // 'male' 또는 'female'만 가능
                birthday: "2003-02-15", // YYYY-MM-DD 형식
                addressCode: "4111113000", // 10자리 숫자 문자열
                addressDetail: "상세주소",
                terms: [
                    { "termId": 1, "isAgreed": true }
                ],
                favoriteFoodIds: [1, 4, 5]
            };
            
            await callAPI('/api/user/signup', userData);
        };

        // 2. 실패 테스트 (이메일 중복 시나리오)
        document.getElementById('signupButtonFail').onclick = async () => {
            // 이미 가입된 이메일이라고 가정 (DB에 이 이메일이 있어야 실패함)
            const userData = {
                email: "user@umc.com", 
                password: "password1234",
                name: "중복천월",
                gender: "female",            
                birthday: "2000-01-01", 
                addressCode: "4111113000",
                addressDetail: "중복 테스트 주소",
                terms: [
                    { "termId": 1, "isAgreed": true }
                ],
                favoriteFoodIds: [1]
            };
            
            await callAPI('/api/user/signup', userData);
        };

        // 3. API 호출 함수
        async function callAPI(path, data) {
            const resultArea = document.getElementById('resultArea');
            resultArea.textContent = `[요청 중...] ${path}`;
            console.log(`%c[요청] ${path}`, 'color: blue;', data);
            
            try {
                const response = await fetch(API_URL + path, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(data) 
                });

                const responseData = await response.json();

                if (!response.ok) { 
                    throw responseData; // 에러 응답도 catch 블록으로 보냄
                }

                // 성공 로그
                console.log('%c[응답] 성공:', 'color: green;', responseData);
                resultArea.textContent = `[성공] \n${JSON.stringify(responseData, null, 2)}`;
                resultArea.style.color = 'green';

            } catch (error) {
                // 실패 로그 (우리가 만든 ErrorResponse 형식)
                console.error('%c[응답] 실패:', 'color: red;', error);
                resultArea.textContent = `[실패] \n${JSON.stringify(error, null, 2)}`;
                resultArea.style.color = 'red';
            }
        }
    </script>
</body>
</html>